<!-- core/templates/core/hunting.html -->

{% extends "core/base.html" %}

{% block title %}Threat Hunting - Defense Platform{% endblock %}

{% block content %}
<div class="bg-gray-900/70 backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-800 p-8 transition-all duration-300 hover:shadow-blue-500/10">
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-extrabold text-white tracking-tight">üïµÔ∏è Threat Hunting</h2>
        <span class="text-sm text-gray-400 italic">Real-time security event analysis</span>
    </div>

    <!-- Filter Form -->
    <form method="get" class="mb-10 border-b border-gray-800 pb-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {% for field in filter.form %}
            <div>
                <label for="{{ field.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">{{ field.label }}</label>
                <div class="relative">
                    {{ field }}
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="mt-8 flex justify-end space-x-3">
            <a href="{% url 'hunting' %}" 
               class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2.5 px-5 rounded-xl transition duration-200 shadow hover:shadow-gray-500/20">
               Reset
            </a>
            <button type="submit" 
                    class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-semibold py-2.5 px-5 rounded-xl transition duration-300 shadow hover:shadow-blue-500/30">
                Search
            </button>
        </div>
    </form>

    <!-- Results Header -->
    <div class="mb-6 flex items-center justify-between">
        <h3 class="text-lg font-semibold text-white flex items-center gap-2">
            <span class="inline-block w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
            Results ({{ results_count }})
        </h3>
        <div class="h-px bg-gradient-to-r from-transparent via-gray-700 to-transparent flex-1 ml-4"></div>
    </div>

    <!-- Results Table -->
    <div class="overflow-x-auto rounded-xl border border-gray-800 shadow-inner">
        <table class="min-w-full text-sm text-left text-gray-300">
            <thead class="bg-gray-800/60 text-gray-300 uppercase text-xs tracking-wider">
                <tr>
                    <th class="p-3">Timestamp</th>
                    <th class="p-3">Severity</th>
                    <th class="p-3">Description</th>
                    <th class="p-3">Source IP</th>
                    <th class="p-3">Status</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-800">
                {% for alert in page_obj %}
                <tr class="hover:bg-gray-800/40 transition duration-150 ease-in-out">
                    <td class="p-3 whitespace-nowrap text-gray-400">{{ alert.timestamp|date:"Y-m-d H:i:s" }}</td>
                    <td class="p-3">
                        <span class="px-2 py-1 rounded-full text-xs font-bold severity-{{ alert.severity|lower }} shadow-sm">
                            {{ alert.get_severity_display }}
                        </span>
                    </td>
                    <td class="p-3">
                        <a href="{% url 'alert-detail' alert.pk %}" class="text-blue-400 hover:text-blue-300 transition hover:underline">
                            {{ alert.description|truncatechars:70 }}
                        </a>
                    </td>
                    <td class="p-3 font-mono text-gray-400">{{ alert.source_ip|default:"N/A" }}</td>
                    <td class="p-3 text-gray-300">{{ alert.get_status_display }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center p-6 text-gray-500 italic">No matching alerts found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="mt-8 flex justify-center items-center space-x-4 text-gray-400">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode|cut:'page=' }}"
               class="px-3 py-2 rounded-lg hover:bg-gray-800/60 hover:text-white transition">&laquo; Previous</a>
        {% endif %}

        <span class="text-sm text-gray-400 bg-gray-800/40 px-3 py-1 rounded-md">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode|cut:'page=' }}"
               class="px-3 py-2 rounded-lg hover:bg-gray-800/60 hover:text-white transition">Next &raquo;</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
