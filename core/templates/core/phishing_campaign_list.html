{% extends "core/base.html" %}

{% block title %}Phishing Campaigns â€” Cyber Command{% endblock %}

{% block content %}
<div class="relative overflow-hidden">

  <!-- ===== CYBER GRID BACKGROUND ===== -->
  <canvas id="cyber-grid" class="fixed inset-0 w-full h-full -z-50"></canvas>
  <div class="fixed inset-0 -z-40 bg-gradient-to-b from-black/80 via-[#00110a]/90 to-[#001b13]/95"></div>

  <!-- ===== PAGE CONTENT ===== -->
  <div class="relative z-10 space-y-16 p-6 animate-fadeIn">

    <!-- Launch New Campaign -->
    <div class="relative rounded-2xl p-10 backdrop-blur-md border border-emerald-800/20 shadow-[0_0_50px_rgba(0,255,150,0.08)] overflow-hidden bg-[#020b08]/90 hover:shadow-[0_0_70px_rgba(0,255,150,0.15)] transition">
      <div class="absolute inset-0 bg-gradient-to-br from-emerald-400/5 via-transparent to-transparent blur-2xl"></div>

      <div class="relative z-10">
        <h2 class="text-3xl font-extrabold text-white mb-4 flex items-center gap-3 tracking-wide">
          <span class="text-emerald-400 drop-shadow-[0_0_8px_rgba(0,255,180,0.7)]">ðŸš€</span>
          Launch New Campaign
        </h2>
        <div class="w-52 h-1 bg-gradient-to-r from-emerald-400 via-cyan-400 to-teal-400 rounded-full mb-6 shadow-[0_0_14px_rgba(0,255,200,0.4)]"></div>

        <form method="post" class="space-y-6">
          {% csrf_token %}

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">Campaign Name</label>
              <input name="name" required placeholder="e.g., Q4 Security Awareness"
                     class="input-glow w-full p-3.5 rounded-xl bg-[#071312] border border-emerald-800/40 text-emerald-100 placeholder-emerald-500 outline-none transition">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">Launch Date</label>
              <input type="datetime-local" name="launch_date" required
                     class="input-glow w-full p-3.5 rounded-xl bg-[#071312] border border-emerald-800/40 text-emerald-100 outline-none transition">
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">Email Template</label>
              <select name="email_template" required
                      class="input-glow w-full p-3.5 rounded-xl bg-[#071312] border border-emerald-800/40 text-emerald-100 outline-none transition">
                <option value="" disabled selected>Select an email template</option>
                {% for template in available_templates %}
                  <option value="{{ template.id }}">{{ template.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">Landing Page</label>
              <select name="landing_page" required
                      class="input-glow w-full p-3.5 rounded-xl bg-[#071312] border border-emerald-800/40 text-emerald-100 outline-none transition">
                <option value="" disabled selected>Select a landing page</option>
                {% for page in available_pages %}
                  <option value="{{ page.id }}">{{ page.name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Select Targets</label>
            <select name="targets" multiple required
                    class="input-glow w-full h-48 p-3.5 rounded-xl bg-[#071312] border border-emerald-800/40 text-emerald-100 outline-none transition">
              {% for target in available_targets %}
                <option value="{{ target.id }}">{{ target.name|default:target.email }} ({{ target.email }})</option>
              {% endfor %}
            </select>
            <p class="text-xs text-gray-500 mt-2 italic">Hold Ctrl (or Cmd) to select multiple targets.</p>
          </div>

          <div class="flex justify-end pt-4">
            <button type="submit" class="btn-primary px-8 py-3 rounded-xl font-semibold tracking-wide">
              ðŸš€ Launch Campaign
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Existing Campaigns -->
    <div class="relative rounded-2xl p-8 backdrop-blur-md border border-emerald-800/20 shadow-[0_0_50px_rgba(0,255,180,0.08)] overflow-hidden bg-[#020b08]/90">
      <div class="relative z-10">
        <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-3 tracking-wide">
          <span class="text-cyan-400 drop-shadow-[0_0_8px_rgba(0,255,255,0.6)]">ðŸ“Š</span>
          Existing Campaigns
        </h3>

        <div class="overflow-hidden border border-emerald-900/20 rounded-xl backdrop-blur-sm">
          <table class="w-full text-sm text-left text-gray-300">
            <thead class="bg-[#071312]/80 text-xs text-gray-400 uppercase tracking-wider">
              <tr class="divide-x divide-emerald-900/20">
                <th class="px-6 py-3">Name</th>
                <th class="px-6 py-3">Status</th>
                <th class="px-6 py-3">Launch Date</th>
                <th class="px-6 py-3 text-center">Targets</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-emerald-900/20">
              {% for campaign in campaigns %}
              <tr class="hover:bg-emerald-900/5 hover:shadow-[0_0_20px_rgba(0,255,180,0.1)] transition duration-200 cursor-pointer">
                <td class="px-6 py-3 font-semibold text-gray-100">
                  <a href="{% url 'phishing_campaign_detail' campaign.id %}" class="text-emerald-400 hover:underline">{{ campaign.name }}</a>
                </td>
                <td class="px-6 py-3">
                  <span class="font-semibold px-2.5 py-1 rounded-full text-xs
                    {% if campaign.status == 'COMPLETED' %} bg-emerald-500/20 text-emerald-300
                    {% elif campaign.status == 'IN_PROGRESS' %} bg-amber-500/20 text-amber-300 animate-pulse
                    {% else %} bg-gray-700/40 text-gray-400 {% endif %}">
                    {{ campaign.get_status_display }}
                  </span>
                </td>
                <td class="px-6 py-3 text-gray-400">{{ campaign.launch_date|date:"Y-m-d H:i" }}</td>
                <td class="px-6 py-3 text-center font-mono text-emerald-400">{{ campaign.targets.count }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center py-10 text-emerald-600 italic">No campaigns created yet.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== BACKGROUND ANIMATION (3D GRID CYBER WAVE) ===== -->
  <script>
  (() => {
    const canvas = document.getElementById('cyber-grid');
    const ctx = canvas.getContext('2d');
    let W, H, t = 0;

    function resize() {
      W = canvas.width = window.innerWidth;
      H = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function draw() {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.09)';
      ctx.fillRect(0, 0, W, H);

      const gridSize = 30;
      ctx.strokeStyle = 'rgba(0, 255, 149, 0.51)';
      ctx.lineWidth = 1;

      for (let y = 0; y < H; y += gridSize) {
        ctx.beginPath();
        for (let x = 0; x < W; x += gridSize) {
          const wave = Math.sin((x + t) * 0.01) * 6 + Math.cos((y + t) * 0.015) * 6;
          ctx.lineTo(x, y + wave);
        }
        ctx.stroke();
      }

      for (let x = 0; x < W; x += gridSize) {
        ctx.beginPath();
        for (let y = 0; y < H; y += gridSize) {
          const wave = Math.sin((y + t) * 0.008) * 6 + Math.cos((x + t) * 0.012) * 6;
          ctx.lineTo(x + wave, y);
        }
        ctx.stroke();
      }

      t += 0.7;
      requestAnimationFrame(draw);
    }
    draw();
  })();
  </script>

  <!-- ===== STYLE ENHANCEMENTS ===== -->
  <style>
    .input-glow {
      transition: all .2s ease;
    }
    .input-glow:hover {
      border-color: rgba(0,255,150,0.5);
      box-shadow: 0 0 15px rgba(0,255,180,0.08);
      transform: translateY(-2px);
    }
    .input-glow:focus {
      border-color: rgba(0,255,180,0.9);
      box-shadow: 0 0 30px rgba(0,255,180,0.12);
      transform: translateY(-2px);
    }

    .btn-primary {
      background: linear-gradient(90deg, #00ff99, #00ffd5, #00ff99);
      background-size: 200% 100%;
      color: #00110a;
      font-weight: bold;
      box-shadow: 0 0 25px rgba(0,255,180,0.15);
      transition: all .3s ease;
      animation: gradientShift 4s linear infinite;
    }
    .btn-primary:hover {
      box-shadow: 0 0 45px rgba(0,255,200,0.25);
      transform: scale(1.03);
    }
    @keyframes gradientShift {
      0% { background-position: 0 0; }
      100% { background-position: 200% 0; }
    }
  </style>

</div>
{% endblock %}
